**Deploy API**
----
  The deploy API provides interfaces
  to manage yaml files of courses to/in mooc-grader.
  
  It is built with the help of [aplus-file-transfer](https://github.com/apluslms/apluslms-file-transfer) package.
 
  
* **Authentication**

  It applies JWT authentication with RS256 algorithm. A JWT token is encoded 
  by a private key in the service [shepherd](https://github.com/apluslms/shepherd), 
  The token is sent in the Authorization header when making requests to the API, 
  and the mooc-grader provides a public key in PEM format to decode and authenticate it. 
  
  An example of a public key:
    ```bash
    JWT_PUBLIC_KEY = """
    -----BEGIN PUBLIC KEY-----
    MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA0QIB6wP5rGpT7pcKM0uQ
    bn3FbQI2Xp58vLW+eLISgPvh0EMNuVWMazRfTBGnSxYI2P2F+Yf+O8Ck3JWOpuCD
    +i0a+RlC7gZdspULHpRYSccOqvRdcMn93nuPxiHJ+zAFuVR6mmDQmkHR3ruFvbQt
    FWABpbZpqVOlaOUqoyQcp7JGOrrGZZhifS8EE56azvhIm8n2qf+KhKkTq0P71j+4
    3h2sZtHM9nrsm/wtyb26xPBwGS1v1d5bWw0D2vhPSCP4HV2DuI6WD6pEN9Axjf5j
    dG7tGa6GnyPchdDAvlnA1FQiFfkz4NQtL5upmGiz6gBslFlPhZmejlr2RUYd4mbQ
    3QIDAQAB
    -----END PUBLIC KEY-----
    """ 
    ```
   The payload of a JWT token generated by [shepherd](https://github.com/apluslms/shepherd) 
   includes the fields Subject, Issuer and Issued at. 
   The Subject field is the name of the course folder, and the Issuer field is restricted, `JWT_ISSUER = shepherd`. 
   An example of the payload component of a JWT token:
    ```bash
   {
   'sub': 'def_course', 
   'iss': 'shepherd',  
   'iat': 1562828304
   }
    ```
* **Methods:**

  `POST /deploy_api/v1/{course_name}/select-files` - Select files of the course to upload
  
  `POST /deploy_api/v1/{course_name}/upload-files` - Upload the files to a temporary course directory 
  
  `GET /deploy_api/v1/{course_name}/publish-files` - Publish the uploaded files to the course directory 
  
  `DELETE /deploy_api/v1/{course_name}/delete` - Delete a course directory 
  
  `DELETE /deploy_api/v1/{course_name}/files/{file_path}` - Delete a file of a course. 
                                                    `{file_path}` is the relative file path related to 
                                                     the course directory
                                                     
  `POST /deploy_api/v1/{course_name}/update-index-file` - Update the index.yaml of a course (used for A+ deploy)
* **Data Params**
  
  Based on the content-type of the request, 
  the `POST`  method need to provide a `data` parameter and/or a `files` parameter.
  
  `content_type == 'application/octet-stream'`: 
  The `data` is a chunk of bytes of a compressed file (tar.gz format). 
  Some necessary information is included in the headers of the request.
  
  `content_type.startswith('multipart/form-data')`:
  The `files` is a file object or the bytes of a compression file. The `data` 
  is a dictionary that contains some necessary information.
  
  
To deploy yaml files of a course, first calling the endpoint `/<course_name>/select-files` 
  to decide which files to upload, and then calling the endpoint `/<course_name>/upload-files` to upload selected files.
  Finally calling `/<course_name>/publish-files` to publish the uploaded files to the server. The docker container of deploying a course to the server is available in [aplus-file-transfer](https://github.com/apluslms/apluslms-file-transfer).



